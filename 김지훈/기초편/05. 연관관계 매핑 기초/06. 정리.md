# 5.6 정리
- 단방향 매핑과 비교해서 양방향 매핑은 복잡하다. 연관관계의 주인도 정해야 하고, 두 개의 단방향 연관관계를 양방향으로 만들기 위해 로직도 잘 관리해야 한다.
- 중요한 사실은 연관관계가 하나인 단방향 매핑은 언제나 연관관계의 주인이라는 점이다. 양방향은 여기에 주인이 아닌 연관관계를 하나 추가했을 뿐이다. 
- 결국 단방향과 비교해서 양방향의 장점은 반대방향으로 객체 그래프 탐색 기능이 추가된 것 뿐이다.
```java
member.getTeam(); // 회원 -> 팀
team.getMembers(); // 팀 -> 회원 (양방향 매핑으로 추가된 기능)
```
- 주인의 반대편은 mappedBy로 주인을 지정해야 한다. 그리고 주인의 반대편은 단순히 보여주는 일(객체 그래프 탐색)만 할 수 있다.
- 내용을 정리하면 다음과 같다.
1. 단방향 매핑만으로 테이블과 객체의 매핑은 이미 완료되었다.
2. 단방향을 양방향으로 만들면 반대방향으로 객체 그래프 탐색 기능이 추가된다.
3. 양방향 연관관계를 매핑하려면 객체에서 양쪽 방향을 모두 관리해야 한다.

- 양방향 매핑은 복잡하다. 비즈니스 로직의 필요에 따라 다르겠지만 우선 단방향 매핑을 사용하고 반대 방향으로 객체 그래프 탐색 기능(JPQL 쿼리 탐색 포함)이 필요할 때
양방향을 사용하도록 코드를 추가해도 된다.

## 연관관계의 주인을 정하는 기준
- 단방향은 항상 외래 키가 있는 곳을 기준으로 매핑하면 된다. 하지만 양방향은 연관관계의 주인(Owner)이라는 이름으로 인해 오해가 있을 수 있다. 비즈니스 로직상 더 중요하다고
연관관계의 주인으로 선택하면 안 된다. 비즈니스 중요도를 배제하고 단순히 외래 키 관리자 정도의 의미만 부여해야 한다.
- 예로 회원과 팀 엔티티는 외래 키가 있는 다 쪽인 회원이 연관관계의 주인이 된다. 물론 비즈니스 중요도를 생각해보면 팀보다 회원이 더 중요한 것 같은 느낌도 들 것이다.
하지만 자동차의 차체와 바퀴를 생각해보면 바퀴가 외래 키가 있는 다 쪽이다. 따라서 바퀴가 연관관계의 주인이 된다. 차체가 더 중요한 것 같아 보이지만 연관관계의 주인은 단순히
외래 키를 매핑한 바퀴를 선택하면 된다.
- 따라서, 연관관계의 주인은 외래 키의 위치와 관련해서 정해야지 비즈니스 중요도로 접근하면 안 된다.

### 주의
- 양방향 매핑 시에는 무한 루프에 빠지지 않게 조심해야 한다. 예를 들어 Member.toString()에서 getTeam()을 호출하고, Team.toString()에서 getMember()를
호출하면 무한 루프에 빠질 수 있다. 이런 문제는 엔티티를 JSON으로 변환할 때 자주 발생하는데, JSON 라이브러리들은 보통 무한루프에 빠지지 않도록 하는 어노테이션이나
기능을 제공. 그리고 롬복 사용시에도 자주 발생.

### 참고
- 일대다 연관관계의 주인으로 선택하는 것이 불가능한 것만은 아니다. 예로 팀 엔티티의 Team.members를 연관관계의 주인으로 선택하는 것이다.
- 하지만 성능과 관리 측면에서 권장하지 않는다. 될 수 있으면 외래 키가 있는 곳을 연관관계의 주인으로 선택하자.
